---
title: Docking Assistant Events
---

### Architecture

The creation wizard consists of two parts.
* The trails controller (`app/controllers/course/wizard.php`) controls the flow of the wizard: which steps there are in the wizard, in which order they are run through, and how the data is passed on.
* The individual steps are encapsulated in classes that implement the interface `CourseWizardStep`.

### The controller

The sequence of the individual steps and the buffering of the entered data are handled in the trails controller. Important actions of the controller are:

**`index_action()`**

This action only serves as an entry point for new events.

**`step_action($number=0, $temp_id=*)`**

A single step is displayed here. The parameter `$number` specifies the number of the step in the sequence. The parameter `$temp_id` is used to keep the data entered for the individual steps available across the steps. If the `$temp_id` is not specified, a new one is generated. All data entered is saved in the session in the form
```php
$_SESSION[$temp_id] = [
    '<StepClassname1>' = [
        'name1' => 'value1',
        ...
    ],
    '<StepClassname2>' = [
        'name2' => 'value2',
        'name3' => ['value3', 'value4'],
        ...
    ],
    ...
];
```
The `$temp_id` looped along with each step ensures that new events can be created in parallel in several tabs. The `$temp_id` assigned here is not the later `seminar_id` of the created event.

**`process_action($step_number, $temp_id)`**

This action is called after submitting the form, all data entered is written to the session.

If "Back" was clicked in the wizard, the previous step is simply called up.

If "Next" was clicked, all the data entered is transferred to the step class. If this fails, the current step is displayed again and error messages generated by the validation are displayed. The generation of error messages (`PageLayout::postMessage` etc.) is carried out in the step class.

Not all registered steps are always necessary, e.g. study areas only need to be specified if a corresponding event type has been selected. If data validation is successful, the controller determines which of the steps entered is the next required step and redirects to its display.

If all the necessary steps have already been completed, a short message is displayed stating that all the necessary data has been entered and the course can now be created. If this is confirmed, the controller creates a new, completely empty, invisible event so that an ID can be generated. This event is then passed sequentially to each of the called step classes so that the event data can be filled with the stored values. Each step class knows exactly how to do this. The modified `Course` object is returned by the class and then passed on to the next step.

After completion, the user is redirected to the administration area of the created event or to "My events" if the creation wizard was called from there in the dialog by admins or roots.

**`ajax_action()`**

Some steps may want to reload data via AJAX. However, the class itself does not have a URL that can serve as an endpoint for such AJAX calls. Therefore, there is this action, which receives the following parameters per request:
* `step`: number of the current step; used to determine the associated class
* `method`: method to be called in the target class that returns the desired data
* `parameter`: this array contains all the parameters required to call the method in the correct order

For example, to be able to call the method `getFoo($param1, $param2)` in the class of step 3, the correct (GET) URL to the controller is:

`<studip>/dispatch.php/course/wizard/ajax?step=3&method=getFoo&parameter[]=<param1>&parameter[]=<param2>`

**`forward_action($step_number, $temp_id)`**

This action is simply used to pass data directly to the step class via a request. This is particularly important if JavaScript is not available. For example, the opening of a study area node is realized by simply appending the parameter `open_node=<id`> to the forward_action.

**`copy_action($id)`**

Is called to copy the event with the ID `$id`. There, the event to be copied is passed sequentially to all registered steps, whose `copy` method extracts the necessary data for each step and thus fills the data array stored in the session for the wizard.

### The `CourseWizardStep` interface

Each class that is to be integrated into the wizard must implement the `CourseWizardStep` interface. This includes the following methods:

**`getStepTemplate($values, $stepnumber, $temp_id)`**

Here the step loads the flexi-template for display and fills its data with the values from the `$values` array. As described above, this array contains all the values entered for all step classes, so if a step only wants to have the values that come from its own class, these are in `$values[__CLASS__]`.

The templates contained in the core are located by default under `app/views/course/wizard/steps`, but each step can regulate this for itself by instantiating a corresponding Flexi_TemplateFactory.

**`isRequired($values)`**

The step uses the transferred, already entered values to determine whether it is required for the creation process. The best-known example of this is the `StudyAreasWizardStep` (assignment of study areas), which only needs to be displayed if a corresponding event type was selected in a previous step.

**`alterValues($values)`**
In addition to the standard buttons for "Next" and "Back", which navigate through the wizard, there may also be other buttons in the input form of a step that send the form. Actions triggered by this are forwarded by the controller directly to this method of the step class, where they can be processed. For example, you can add buttons that accept certain values without Javascript. Direct calls to the `forward` method in the controller, which generate a request without submitting the form, are also passed here.

**`validate($values)`**

When proceeding to the next step in the wizard, the data entered so far is passed to this class method to be checked for completeness and plausibility. In the event of an error, corresponding messages must also be generated here, e.g. via `PageLayout::postMessage`. As with `getStepTemplate`, all values of all step classes are also transferred here, i.e. the user's own values are available via `$values[__CLASS__]`.

**`storeValues($course, $values)`**

This method is called directly before the course is created. The transferred course object represents the event to be created, which can be further filled with the transferred values. The following also applies here: $values contains all values of all step classes.

**`copy($course, $values)`**

This method can be used to fill the $values array with values that can come from the transferred course object (= the event to be copied), for example.
